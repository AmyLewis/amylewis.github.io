<!DOCTYPE html><html lang="zh-cn"><head><meta charset="utf-8"><title>Python 包管理编年史 | Amyy Lewis</title><meta http-equiv="X-UA-Compatible" content="IE=Edge,chrome=1"><meta name="viewport" content="width=device-width,initial-scale=1,maximum-scale=1,user-scalable=no"><meta name="format-detection" content="telephone=no"><meta name="author" content="[object Object]"><meta name="designer" content="minfive"><meta name="keywords" content="life tech"><meta name="description" content="Fledgling Developer | Backpacker | Doing all I can to be a better girl."><meta name="apple-mobile-web-app-capable" content="yes"><meta name="apple-mobile-web-app-status-bar-style" content="black"><meta name="format-detection" content="telephone=yes"><meta name="mobile-web-app-capable" content="yes"><meta name="robots" content="all"><link rel="canonical" href="http://amylewis.github.io/2018/07/08/python-package/index.html"><link rel="icon" type="image/png" href="http://oo12ugek5.bkt.clouddn.com/blog/images/favicon.ico" sizes="32x32"><link rel="stylesheet" href="/scss/base/index.css"><link rel="alternate" href="/atom.xml" title="AmyLewis" type="application/atom+xml"><script async src="https://www.googletagmanager.com/gtag/js?id=UA-66043212-2"></script><script>function gtag(){dataLayer.push(arguments)}window.dataLayer=window.dataLayer||[],gtag("js",new Date),gtag("config","UA-66043212-2")</script><link rel="stylesheet" href="/scss/views/page/post.css"><meta name="generator" content="Hexo 6.3.0"></head><body ontouchstart><div id="page-loading" class="page page-loading" style="background-image:url(https://user-images.githubusercontent.com/3325198/52893052-6d1d2d80-31d3-11e9-91c2-736385c3278a.gif)"></div><div id="page" class="page js-hidden"><header class="page__small-header page__header--small"><nav class="page__navbar"><div class="page__container navbar-container"><a class="page__logo" href="/" title="AmyLewis" alt="AmyLewis"><img src="https://user-images.githubusercontent.com/3325198/52892707-fc284680-31cf-11e9-932d-e3cde3ef02f3.png" alt="AmyLewis"></a><nav class="page__nav"><ul class="nav__list clearfix"><li class="nav__item"><a href="/" alt="首页" title="首页">首页</a></li><li class="nav__item"><a href="/archives" alt="归档" title="归档">归档</a></li><li class="nav__item"><a href="/about" alt="关于" title="关于">关于</a></li></ul></nav><button class="page__menu-btn" type="button"><i class="iconfont icon-menu"></i></button></div></nav></header><main class="page__container page__main"><div class="page__content"><article class="page__post"><div class="post__cover"><img src="https://user-images.githubusercontent.com/3325198/52894690-29352300-31e9-11e9-806f-52588e3b4fa9.jpg" alt="Python 包管理编年史"></div><header class="post__info"><h1 class="post__title">Python 包管理编年史</h1><div class="post__mark"><div class="mark__block"><i class="mark__icon iconfont icon-write"></i><ul class="mark__list clearfix"><li class="mark__item"><a target="_blank" rel="noopener" href="https://www.github.com/amylewis">amy</a></li></ul></div><div class="mark__block"><i class="mark__icon iconfont icon-time"></i><ul class="mark__list clearfix"><li class="mark__item"><span>2018-07-08</span></li></ul></div><div class="mark__block"><i class="mark__icon iconfont icon-tab"></i><ul class="mark__list clearfix"><li class="mark__item"><a href="/tags/tech/">Tech</a></li></ul></div></div></header><div class="post__content"><p><strong>Table of content:</strong></p><div class="toc"><ul><li><a href="#about">About</a></li><li><a href="#guan-yu-zip-eggs-wheel-de-ge-shi">关于 zip, eggs, wheel 的格式</a></li><li><a href="#zai-yi-lai-guan-li-shang-mu-qian-you-yi-xia-ji-chong-fang-an">在依赖管理上，目前有以下几种方案</a><ul><li><a href="#pip-requirement-txt">pip + requirement.txt</a></li><li><a href="#buildout">buildout</a></li><li><a href="#pipenv-python-guan-fang-tui-jian-de-guan-li-yi-lai-gong-ju">pipenv, Python 官方推荐的管理依赖工具</a></li></ul></li><li><a href="#virtual-env-guan-li">virtual env 管理</a><ul><li><a href="#tox">tox</a></li><li><a href="#venv">venv</a></li><li><a href="#virtualenvwrapper">virtualenvwrapper</a></li></ul></li><li><a href="#hou-xu-todo">后续 todo</a></li><li><a href="#reference">Reference</a></li><li><a href="#guan-yu-tou-tu">关于头图</a></li></ul></div><br><h2><span id="about">About</span><a href="#about" class="header-anchor"></a></h2><p>看到 pip，distutils、distutils2， setuptools、easy_install、ez_setup.py， pip, setup.py 是不是会崩溃！ 而这里的时间先后顺序是：</p><ul><li>distutils 是 python 标准库的一部分，2000年发布。使用它能够进行 python 模块的安装和发布。</li><li>distutils2 被设计为 distutils 的替代品，后来这个计划停滞了。</li><li>setuptools 是一个为了增强 distutils 而开发的集合，2004年发布。它包含了 easy_install 这个工具。</li><li>ez_setup.py 是 setuptools 的安装工具。ez 是 easy 的缩写，比如一些简答的用法:</li><li>distribute 是 setuptools 的一个分支版本，后来又合并到了 setuptools。</li><li>pip 是目前 python 包管理的事实标准，2008年发布。它被用作 easy_install 的替代品，但是它仍有大量的功能建立在 setuptools 组件之上。</li><li>pip 希望不再使用 Eggs 格式（虽然它支持 Eggs），而更希望采用「源码发行版」（使用 python setup.py sdist 创建）</li></ul><h2><span id="guan-yu-zip-eggs-wheel-de-ge-shi">关于 zip, eggs, wheel 的格式</span><a href="#guan-yu-zip-eggs-wheel-de-ge-shi" class="header-anchor"></a></h2><ul><li>一开始 distutils 是 python steup.py sdit, 打包成 zip 或 tar.gz 格式</li><li>然后 setuptools 出现了 eggs 格式</li><li>再后来 wheel 格式想替代 eggs 格式</li></ul><p>wheel 本质上是一个 zip 包格式，它使用 .whl 扩展名，用于 python 模块的安装，它的出现是为了替代 Eggs。<br>wheel 还提供了一个 bdist_wheel 作为 setuptools 的扩展命令，这个命令可以用来生成 wheel 包。<br>wheel 包是一种预编译的包，不需要系统里安装对应的头文件就可以使用，可以极大程度简化构建的步骤。</p><p><a target="_blank" rel="noopener" href="https://pythonwheels.com/">Python Wheels</a>上提到的优势还有：</p><ol><li>Faster installation for pure Python and native C extension packages.</li><li>Avoids arbitrary code execution for installation. (Avoids setup.py)</li><li>Installation of a C extension does not require a compiler on Windows or macOS.</li><li>Allows better caching for testing and continuous integration.</li><li>Creates .pyc files as part of installation to ensure they match the Python interpreter used.</li><li>More consistent installs across platforms and machines.</li></ol><p><a target="_blank" rel="noopener" href="https://pythonwheels.com/">Python Wheels</a> 上能看到使用 Wheels 发行的 python 模块在 PyPI 上的占有率，同时各个包管理工具也进行了支持：</p><ul><li>pip 支持 wheel,(需要安装 wheel 模块), 不再支持 eggs (原来 eggs 用 esay_install 安装)</li><li>setup.cfg 可以用来定义 wheel 打包时候的相关信息。</li><li>buildout 在 2.8.0 以后支持了 wheel 包的安装，wheel 包是一种预编译的包，不需要我们系统里安装对应的头文件就可以使用，可以极大程度简化构建的步骤。<br>在 buildout.cfg 中增加一行 <code>extensions = buildout.wheel</code> :</li></ul><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">[buildout]</span><br><span class="line">index = https://mirror.xxx.com/simple/</span><br><span class="line">update-versions-file = versions.cfg</span><br><span class="line">extends = versions.cfg</span><br><span class="line">develop  = .</span><br><span class="line">extensions = buildout.wheel</span><br></pre></td></tr></table></figure><h2><span id="zai-yi-lai-guan-li-shang-mu-qian-you-yi-xia-ji-chong-fang-an">在依赖管理上，目前有以下几种方案</span><a href="#zai-yi-lai-guan-li-shang-mu-qian-you-yi-xia-ji-chong-fang-an" class="header-anchor"></a></h2><h3><span id="pip-requirement-txt">pip + requirement.txt</span><a href="#pip-requirement-txt" class="header-anchor"></a></h3><ul><li>pip 可以利用 requirments.txt 来实现依赖的安装。</li><li>支持 git&#x2F;svn&#x2F;hg 等流行的 VCS 系统，可以直接从 gz 或者 zip 压缩包安装，支持搜索包，以及指定服务器安装等等功能。</li></ul><p>很多开源项目都是把依赖写在 requirement.txt 里面。然后 <code>pip install -r requirements.txt</code></p><p>但是这样有几个问题:</p><ul><li>依赖的依赖版本没有被管理，以致于每次 pip install 装到的版本都是未知的，带来一些不可预测的问题</li><li>KENNETH REITZ 提出过这个问题和一些思路 <a target="_blank" rel="noopener" href="https://www.kennethreitz.org/essays/a-better-pip-workflow">https://www.kennethreitz.org/essays/a-better-pip-workflow</a></li></ul><h3><span id="buildout">buildout</span><a href="#buildout" class="header-anchor"></a></h3><p>buildout 的使用可以看下这个文档： <a target="_blank" rel="noopener" href="http://www.buildout.org/en/latest/getting-started.html">http://www.buildout.org/en/latest/getting-started.html</a> 这里只提一些最佳实践和发现过的问题。</p><h5><span id="ban-ben-suo-ding">版本锁定：</span><a href="#ban-ben-suo-ding" class="header-anchor"></a></h5><p>在项目根目录新建一个 versions.cfg 的文件， 锁定依赖的版本号</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">echo &quot;[versions]&quot; &gt; versions.cfg</span><br></pre></td></tr></table></figure><p>在 buildout.cfg 指定 extends，一个 demo</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br></pre></td><td class="code"><pre><span class="line">[buildout]</span><br><span class="line">index = https://your_mirror.xxx.com/simple/</span><br><span class="line">relative-paths = true # 使 buildout 生成的 bin 文件和当前路径无关，方便文件夹移动位置后复用</span><br><span class="line">update-versions-file = versions.cfg   # ask Buildout to maintain our versions.cfg file for us</span><br><span class="line">extends = versions.cfg  # 指定一个额外的 versions.cfg 的文件</span><br><span class="line">newest   = false  # 如果为 true 则永远选用最新的稳定版</span><br><span class="line">develop  = .</span><br><span class="line">parts    = app</span><br><span class="line">extensions = buildout.wheel   # buildout 在 2.10.0 以后不需要配置 extensions 就可以安装 wheel 包了，原因是 setuptools 原生支持了 wheel 扩展。确保 setuptools &gt;= 38.2.3</span><br><span class="line">eggs     = cython</span><br><span class="line">           datasync-api</span><br><span class="line"></span><br><span class="line">[app]</span><br><span class="line">recipe = zc.recipe.egg</span><br><span class="line">interpreter = python</span><br><span class="line">eggs = $&#123;buildout:eggs&#125;</span><br><span class="line">       pytest</span><br><span class="line">       mock</span><br></pre></td></tr></table></figure><p>在项目中执行 buildout ，buildout 会自动将当前使用的依赖版本 dump 到 versions.cfg 中。</p><h5><span id="buildout-de-yi-xie-keng">buildout 的一些坑</span><a href="#buildout-de-yi-xie-keng" class="header-anchor"></a></h5><p>但是其实 buildout 没有做到和系统的隔离，比如以下是遇到过的坑：</p><ul><li>如果系统里面有一个包了，buildout 就不会下载 eggs 到对应的目录下</li><li>如果 eggs 里面有一个包，但是系统也有，会优先用系统的</li></ul><h3><span id="pipenv-python-guan-fang-tui-jian-de-guan-li-yi-lai-gong-ju">pipenv, Python 官方推荐的管理依赖工具</span><a href="#pipenv-python-guan-fang-tui-jian-de-guan-li-yi-lai-gong-ju" class="header-anchor"></a></h3><h5><span id="pipenv-xiang-yao-jie-jue-shi-me-wen-ti">pipenv 想要解决什么问题 ？</span><a href="#pipenv-xiang-yao-jie-jue-shi-me-wen-ti" class="header-anchor"></a></h5><ul><li>你不用 pip 和 virtualenv 需要两者分开使用了</li><li>使用 requiresments.txt 的方式来管理依赖有很多问题，上面已经描述过了。而 pipenv 用 Pipfile 和 Pipfile.lock 来解决了需要的依赖，以及依赖的依赖版本的问题。</li><li>可以用 <code>pipenv graph</code> 看到依赖树</li></ul><p>基本使用：</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">pipenv install requests</span><br><span class="line"># 这个步骤会生成一个 Pipfile 和 Pipfile.lock， 依赖会被安装在一个默认的位置</span><br></pre></td></tr></table></figure><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"># 如果想要更改这个默认的配置，比如，和 project 路径下，可以参考</span><br><span class="line">PIPENV_VENV_IN_PROJECT=. pipenv --two install requests</span><br></pre></td></tr></table></figure><p>Pipfile 里面会有一些依赖信息</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line">[[source]]</span><br><span class="line">url = &quot;https://pypi.python.org/simple&quot;</span><br><span class="line">verify_ssl = true</span><br><span class="line">name = &quot;pypi&quot;</span><br><span class="line"></span><br><span class="line">[packages]</span><br><span class="line">requests = &quot;*&quot;</span><br><span class="line"></span><br><span class="line">[dev-packages]</span><br><span class="line"></span><br><span class="line">[requires]</span><br><span class="line">python_version = &quot;3.6&quot;</span><br></pre></td></tr></table></figure><p>Pipenv.lock 文件，里面有所有包依赖的版本和 hash 信息</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br></pre></td><td class="code"><pre><span class="line">&#123;</span><br><span class="line">    &quot;_meta&quot;: &#123;</span><br><span class="line">        &quot;hash&quot;: &#123;</span><br><span class="line">            &quot;sha256&quot;: &quot;33a0ec7c8e3bae6f62dd618f847de92ece20e2bd4efb496927e2524b9c7b8df8&quot;</span><br><span class="line">        &#125;,</span><br><span class="line">        &quot;pipfile-spec&quot;: 6,</span><br><span class="line">        &quot;requires&quot;: &#123;</span><br><span class="line">            &quot;python_version&quot;: &quot;3.6&quot;</span><br><span class="line">        &#125;,</span><br><span class="line">        &quot;sources&quot;: [</span><br><span class="line">            &#123;</span><br><span class="line">                &quot;name&quot;: &quot;pypi&quot;,</span><br><span class="line">                &quot;url&quot;: &quot;https://pypi.python.org/simple&quot;,</span><br><span class="line">                &quot;verify_ssl&quot;: true</span><br><span class="line">            &#125;</span><br><span class="line">        ]</span><br><span class="line">    &#125;,</span><br><span class="line">    &quot;default&quot;: &#123;</span><br><span class="line">        &quot;requests&quot;: &#123;</span><br><span class="line">            &quot;hashes&quot;: [</span><br><span class="line">                &quot;sha256:6a1b267aa90cac58ac3a765d067950e7dbbf75b1da07e895d1f594193a40a38b&quot;,</span><br><span class="line">                &quot;sha256:9c443e7324ba5b85070c4a818ade28bfabedf16ea10206da1132edaa6dda237e&quot;</span><br><span class="line">            ],</span><br><span class="line">            &quot;index&quot;: &quot;pypi&quot;,</span><br><span class="line">            &quot;version&quot;: &quot;==2.18.4&quot;</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;,</span><br><span class="line">    &quot;develop&quot;: &#123;&#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>查看锁版本的信息</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">pipenv lock -r  </span><br></pre></td></tr></table></figure><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">certifi==2018.1.18</span><br><span class="line">chardet==3.0.4</span><br><span class="line">idna==2.6</span><br><span class="line">requests==2.18.4</span><br><span class="line">urllib3==1.22</span><br></pre></td></tr></table></figure><p>查看依赖的图</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">pipenv graph</span><br></pre></td></tr></table></figure><p>可以看到一个依赖，以及它依赖的版本的结构</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">requests==2.18.4</span><br><span class="line">  - certifi [required: &gt;=2017.4.17, installed: 2018.1.18]</span><br><span class="line">  - chardet [required: &gt;=3.0.2,&lt;3.1.0, installed: 3.0.4]</span><br><span class="line">  - idna [required: &lt;2.7,&gt;=2.5, installed: 2.6]</span><br><span class="line">  - urllib3 [required: &gt;=1.21.1,&lt;1.23, installed: 1.22]</span><br></pre></td></tr></table></figure><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">pipenv lock -r</span><br><span class="line"># 从 Pipfile 生成 Pipfile.lock, 但是实验发现如果依赖版本写在 setup.py 里面是不会锁版本到 Pipfile.lock 里面的</span><br></pre></td></tr></table></figure><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">pipenv install -e .</span><br><span class="line"># 将 setup.py 里面的依赖锁到 Pipfile.lock 中</span><br></pre></td></tr></table></figure><h2><span id="virtual-env-guan-li">virtual env 管理</span><a href="#virtual-env-guan-li" class="header-anchor"></a></h2><h3><span id="tox">tox</span><a href="#tox" class="header-anchor"></a></h3><p>tox 是一个虚拟环境管理命令行工具，</p><ul><li>checking your package installs correctly with different Python versions and interpreters * 检查你的软件包能否在不同的 Python 版本或解释器下正常安装</li><li>running your tests in each of the environments, configuring your test tool of choice 在不同的环境中运行运行你的测试代码</li><li>acting as a frontend to Continuous Integration servers, greatly reducing boilerplate and merging CI and shell-based testing. （没懂具体是什么样子）</li></ul><p>安装</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">pip install tox</span><br><span class="line">tox</span><br></pre></td></tr></table></figure><p>tox 会去读 setup.py 同目录下的 tox.ini 配置文件，可以通过 <code>tox-quickstart</code> 来生成配置文件，以下是一个例子：</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br></pre></td><td class="code"><pre><span class="line">[tox]</span><br><span class="line"># 指定源</span><br><span class="line">indexserver =</span><br><span class="line">    default = https://mirror.xxx.com/simple</span><br><span class="line"></span><br><span class="line"># 支持的版本</span><br><span class="line">envlist = py27, py3</span><br><span class="line"></span><br><span class="line">[testenv]</span><br><span class="line">commands =</span><br><span class="line">    &#123;envbindir&#125;/python setup.py develop  # ？？？</span><br><span class="line">    pytest --cov-report term-missing --cov-report xml --cov=diplomat tests/</span><br><span class="line"># 测试的依赖</span><br><span class="line">deps =</span><br><span class="line">    pytest</span><br><span class="line">    pytest-cov</span><br><span class="line">    flexmock</span><br></pre></td></tr></table></figure><p>Reference:</p><ul><li>官方文档 <a target="_blank" rel="noopener" href="https://tox.readthedocs.io/en/latest/#basic-example">https://tox.readthedocs.io/en/latest/#basic-example</a></li><li>一个使用的博客 <a target="_blank" rel="noopener" href="https://mozillazg.com/2014/07/python-use-tox-test-code.html">https://mozillazg.com/2014/07/python-use-tox-test-code.html</a></li></ul><h3><span id="venv">venv</span><a href="#venv" class="header-anchor"></a></h3><p>Python3</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line"># start, 试用于 Python3</span><br><span class="line">ᐅ python3 -m venv .venv  # 这时会在当前路径出现 .venv 的目录，或者也可以 virtualenv  .</span><br><span class="line">ᐅ ls .venv</span><br><span class="line">bin        include    lib        pyvenv.cfg</span><br><span class="line"></span><br><span class="line"># acticate，激活环境</span><br><span class="line">ᐅ source .venv/bin/activate</span><br><span class="line"></span><br><span class="line"># 这样 Python path 就是： &#123;your project path&#125;/.venv/bin/python 了</span><br><span class="line"></span><br><span class="line"># leave</span><br><span class="line">ᐅ deactivate</span><br></pre></td></tr></table></figure><p>Python2</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">virtualenv -p /usr/bin/python2.7 .venv  #在当前路径 的 .venv 下创建虚拟环境</span><br><span class="line">source bin/activate  # 激活环境</span><br><span class="line"></span><br><span class="line"># 这样 Python path 就是： &#123;your project path&#125;/bin/python 了</span><br></pre></td></tr></table></figure><h3><span id="virtualenvwrapper">virtualenvwrapper</span><a href="#virtualenvwrapper" class="header-anchor"></a></h3><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><span class="line"># install</span><br><span class="line">pip install virtualenvwrapper</span><br><span class="line"></span><br><span class="line"># save to ~/.zshrc or ~/.bashrc</span><br><span class="line">export WORKON_HOME=$HOME/.virtualenvs</span><br><span class="line">export PROJECT_HOME=$HOME/Devel</span><br><span class="line">source /usr/local/bin/virtualenvwrapper.sh</span><br><span class="line"></span><br><span class="line"># activate a env</span><br><span class="line">mkvirtualenv name  </span><br><span class="line">workon name</span><br><span class="line"></span><br><span class="line"># delete a env</span><br><span class="line">deactivate name</span><br><span class="line">rmvirtualenv mynewenv</span><br></pre></td></tr></table></figure><h2><span id="hou-xu-todo">后续 todo</span><a href="#hou-xu-todo" class="header-anchor"></a></h2><ul><li>更加完善每个工具背后的好处坏处</li></ul><h2><span id="reference">Reference</span><a href="#reference" class="header-anchor"></a></h2><ul><li><a target="_blank" rel="noopener" href="https://docs.pipenv.org/">https://docs.pipenv.org/</a></li><li>Pipfile 和 setup.py：<ul><li>Library: Libraries provide reusable functionality to other libraries and applications (let’s use the umbrella term projects here). They are required to work alongside other libraries, all with their own set of subdependencies. They define abstract dependencies. To avoid version conflicts in subdependencies of different libraries within a project, libraries should never ever pin dependency versions. Although they may specify lower or (less frequently) upper bounds, if they rely on some specific feature&#x2F;fix&#x2F;bug. Library dependencies are specified via install_requires in setup.py.</li><li>Library 还是需要在 setup.py 里面指定依赖的版本，可以通过 <code>pipenv install -e .</code> 来将 setup.py 里面的依赖锁到 Pipfile.lock 中， 直接 <code>pipenv install</code> 是不会进行这个步骤的</li></ul></li><li>一些高阶用法 <a target="_blank" rel="noopener" href="https://docs.pipenv.org/advanced/#pipfile-vs-setuppy">https://docs.pipenv.org/advanced/#pipfile-vs-setuppy</a></li><li>wheel <a target="_blank" rel="noopener" href="https://www.python.org/dev/peps/pep-0427/">https://www.python.org/dev/peps/pep-0427/</a></li><li><a target="_blank" rel="noopener" href="https://pythonwheels.com/">Python Wheels</a></li><li><a target="_blank" rel="noopener" href="http://iusepython.com/2017/02/10/Python%E5%8C%85%E5%B7%A5%E5%85%B7%E6%A2%B3%E7%90%86/">包管理工具的一些梳理</a></li><li><a target="_blank" rel="noopener" href="https://realpython.com/pipenv-guide/">https://realpython.com/pipenv-guide/</a></li><li>wen 对 pip 的一些调研<ol><li>使用这些参数实例化 PipSession, PackageFinder 这两个类。 其中 PipSession 是对 requests.session 的包装，就做一些网络操作， 下载 wheel 包或者 sdist 包都需要用到它。 PackageFinder 的作用就和它名字一样，它会根据你设置的参数：什么平台、 什么版本去 index server 上找合适的包。</li><li>用实例化出来的 session 和 finder 去构造 RequirementSet。这个类 的构造函数允许传 18 个参数，就问你怕不怕。pip 会用它去帮我们下载、安装包 以及包的依赖。RequirementSet 这个类干的事情太多了，基本上干 每件事情都需要用到它。很奇葩。</li></ol></li><li>virtualenvs <a target="_blank" rel="noopener" href="http://docs.python-guide.org/en/latest/dev/virtualenvs/">http://docs.python-guide.org/en/latest/dev/virtualenvs/</a></li><li>这里有一些系统的分析：<a target="_blank" rel="noopener" href="http://docs.python-guide.org/en/latest/dev/virtualenvs/">http://docs.python-guide.org/en/latest/dev/virtualenvs/</a></li></ul><h2><span id="guan-yu-tou-tu">关于头图</span><a href="#guan-yu-tou-tu" class="header-anchor"></a></h2><ul><li>拍摄自迪拜 Mall</li></ul><div class="post__prevs"><div class="post__prev"><a href="/2018/07/08/python-schedule/" title="Python schedule 源码阅读"><i class="iconfont icon-prev"></i>Python schedule 源码阅读</a></div><div class="post__prev post__prev--right"><a href="/2018/07/08/fulei/" title="傅雷家书，先做人，再做艺术家">傅雷家书，先做人，再做艺术家<i class="iconfont icon-next"></i></a></div></div></div></article><div id="disqus_thread"></div></div><aside class="page__sidebar"><form id="page-search-from" class="page__search-from" action="/search/"><label class="search-form__item"><input class="input" type="text" name="search" placeholder="Search..."> <i class="iconfont icon-search"></i></label></form><div class="sidebar__block"><h3 class="block__title">简介</h3><p class="block__text">Fledgling Developer | Backpacker | Doing all I can to be a better girl.</p></div><div class="sidebar__block"><h3 class="block__title">文章分类</h3><ul class="block-list"><li class="block-list-item"><a class="block-list-link" href="/categories/tech/">tech</a><span class="block-list-count">20</span></li><li class="block-list-item"><a class="block-list-link" href="/categories/reading/">reading</a><span class="block-list-count">6</span></li><li class="block-list-item"><a class="block-list-link" href="/categories/music/">music</a><span class="block-list-count">8</span></li><li class="block-list-item"><a class="block-list-link" href="/categories/life/">life</a><span class="block-list-count">37</span></li></ul></div><div class="sidebar__block"><h3 class="block__title">最新文章</h3><ul class="block-list latest-post-list"><li class="latest-post-item"><a href="/2022/09/30/2022-02-09-digest/" title="2022 年 2 ~ 9 月摘要"><div class="item__cover"><img src="https://user-images.githubusercontent.com/3325198/194582186-ee38f13c-5d74-42e4-b1c1-90045c865a09.jpeg" alt="2022 年 2 ~ 9 月摘要"></div><div class="item__info"><h3 class="item__title">2022 年 2 ~ 9 月摘要</h3><span class="item__text">2022-09-30</span></div></a></li><li class="latest-post-item"><a href="/2022/01/31/2021-12-digest/" title="2021 年 12 月 & 1 月摘要"><div class="item__cover"><img src="https://user-images.githubusercontent.com/3325198/152668876-eb16783b-8204-432e-9d98-17a9e5a9b510.jpeg" alt="2021 年 12 月 & 1 月摘要"></div><div class="item__info"><h3 class="item__title">2021 年 12 月 & 1 月摘要</h3><span class="item__text">2022-01-31</span></div></a></li><li class="latest-post-item"><a href="/2021/11/30/2021-11-digest/" title="2021 年 11 月摘要"><div class="item__cover"><img src="https://user-images.githubusercontent.com/3325198/145077778-da1bc9f0-d052-423e-a8a2-4128c1fe12ee.jpeg" alt="2021 年 11 月摘要"></div><div class="item__info"><h3 class="item__title">2021 年 11 月摘要</h3><span class="item__text">2021-11-30</span></div></a></li><li class="latest-post-item"><a href="/2021/10/31/2021-10-digest/" title="2021 年 10 月摘要"><div class="item__cover"><img src="https://user-images.githubusercontent.com/3325198/140796892-d61c5310-8b08-49bd-955f-7d1f36ed8458.jpeg" alt="2021 年 10 月摘要"></div><div class="item__info"><h3 class="item__title">2021 年 10 月摘要</h3><span class="item__text">2021-10-31</span></div></a></li></ul></div><div class="sidebar__block"><h3 class="block__title">文章标签</h3><ul class="block-list tag-list clearfix"><li class="tag-item"><a class="tag-link" href="/tags/algorithm/">algorithm</a></li><li class="tag-item"><a class="tag-link" href="/tags/code-reading/">code_reading</a></li><li class="tag-item"><a class="tag-link" href="/tags/cookbook/">cookbook</a></li><li class="tag-item"><a class="tag-link" href="/tags/digest/">digest</a></li><li class="tag-item"><a class="tag-link" href="/tags/life/">life</a></li><li class="tag-item"><a class="tag-link" href="/tags/music-log/">music_log</a></li><li class="tag-item"><a class="tag-link" href="/tags/reading/">reading</a></li><li class="tag-item"><a class="tag-link" href="/tags/tech/">tech</a></li><li class="tag-item"><a class="tag-link" href="/tags/%E5%AE%9E%E9%AA%8C/">实验</a></li></ul></div></aside></main><footer class="page__footer"><section class="footer__bottom"><div class="page__container footer__container"><p class="footer__copyright">© <a href="https://github.com/Mrminfive/hexo-theme-skapp" target="_blank">Skapp</a> 2018 powered by <a href="http://hexo.io/" target="_blank">Hexo</a>, made by <a href="https://github.com/Mrminfive" target="_blank">minfive</a>, modified by <a href="https://github.com/AmyLewis" target="_blank">amy</a></p><ul class="footer__social-network clearfix"><li class="social-network__item"><a href="https://github.com/AmyLewis" target="_blank" title="github"><i class="iconfont icon-github"></i></a></li><li class="social-network__item"><a href="mailto:amylewis.private@gmail.com" target="_blank" title="email"><i class="iconfont icon-email"></i></a></li><li class="social-network__item"><a href="/atom.xml" target="_blank" title="rss"><i class="iconfont icon-rss"></i></a></li></ul></div></section></footer><div id="back-top" class="back-top back-top--hidden js-hidden"><i class="iconfont icon-top"></i></div></div><script src="/js/common.js"></script><script src="/js/page/post.js"></script><script>var disqus_shortname="amylewis777",disqus_config=function(){this.page.url="http://amylewis.github.io/2018/07/08/python-package/",this.page.identifier="/2018/07/08/python-package/",this.page.title="Python 包管理编年史"};!function(){var t=document,e=t.createElement("script");e.src="https://"+disqus_shortname+".disqus.com/embed.js",e.setAttribute("data-timestamp",+new Date),(t.head||t.body).appendChild(e)}()</script><noscript>Please enable JavaScript to view the <a target="_blank" rel="noopener" href="https://disqus.com/?ref_noscript">comments powered by Disqus.</a></noscript></body></html>